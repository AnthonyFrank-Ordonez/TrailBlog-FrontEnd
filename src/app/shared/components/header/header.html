<!-- Mobile Header -->
<!-- Top Header -->
<header
  class="text-secondary fixed top-0 right-0 left-0 z-999 border-b border-white/30 bg-black transition-transform duration-300 ease-in-out lg:hidden"
  [class.transform]="true"
  [class.-translate-y-full]="hideHeader"
>
  <div class="flex items-center justify-between px-4 py-3">
    <div class="flex items-center space-x-2">
      <!-- Hamburger Menu -->
      <button class="p-1">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
      </button>

      <!-- Logo and Filter -->
      <div class="flex items-center space-x-2">
        <span class="text-lg font-bold">Trail</span>
        <svg class="h-4 w-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </div>
    </div>

    <div class="flex items-center">
      <!-- Search Icon -->
      <button class="flex items-center">
        <svg class="text-secondary h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          ></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Bottom Nav -->
<nav
  class="fixed right-0 bottom-0 left-0 z-50 border-t border-t-white/30 bg-black transition-transform duration-300 ease-in-out lg:hidden"
  [class.transform]="true"
  [class.translate-y-full]="hideBottomNav"
>
  <div class="flex items-center justify-around py-1">
    <button
      class="flex flex-col items-center justify-center space-y-1 p-2"
      [class.text-secondary]="activeTab() === 'home'"
      [class.text-gray-500]="activeTab() !== 'home'"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="icon icon-tabler icons-tabler-filled icon-tabler-home"
      >
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <path
          d="M12.707 2.293l9 9c.63 .63 .184 1.707 -.707 1.707h-1v6a3 3 0 0 1 -3 3h-1v-7a3 3 0 0 0 -2.824 -2.995l-.176 -.005h-2a3 3 0 0 0 -3 3v7h-1a3 3 0 0 1 -3 -3v-6h-1c-.89 0 -1.337 -1.077 -.707 -1.707l9 -9a1 1 0 0 1 1.414 0m.293 11.707a1 1 0 0 1 1 1v7h-4v-7a1 1 0 0 1 .883 -.993l.117 -.007z"
        />
      </svg>

      <span class="text-xs">Home</span>
    </button>

    <button
      class="flex flex-col items-center justify-center space-y-1 p-2 text-gray-500"
      [class.text-secondary]="activeTab() === 'explore'"
      [class.text-gray-500]="activeTab() !== 'explore'"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        viewBox="0 0 24 24"
        id="Explore-Fill--Streamline-Sharp-Fill-Material"
        height="24"
        width="24"
      >
        <path
          d="m6.575 17.425 7.25 -3.575 3.575 -7.25 -7.25 3.575 -3.575 7.25ZM12 13c-0.28335 0 -0.52085 -0.09585 -0.7125 -0.2875S11 12.28335 11 12c0 -0.28335 0.09585 -0.52085 0.2875 -0.7125S11.71665 11 12 11c0.28335 0 0.52085 0.09585 0.7125 0.2875S13 11.71665 13 12c0 0.28335 -0.09585 0.52085 -0.2875 0.7125S12.28335 13 12 13Zm0 9c-1.36665 0 -2.65835 -0.2625 -3.875 -0.7875 -1.21665 -0.525 -2.27915 -1.24165 -3.1875 -2.15 -0.908335 -0.90835 -1.625 -1.97085 -2.15 -3.1875C2.2625 14.65835 2 13.36665 2 12c0 -1.38335 0.2625 -2.68335 0.7875 -3.9 0.525 -1.21665 1.241665 -2.275 2.15 -3.175 0.90835 -0.9 1.97085 -1.6125 3.1875 -2.1375C9.34165 2.2625 10.63335 2 12 2c1.38335 0 2.68335 0.2625 3.9 0.7875 1.21665 0.525 2.275 1.2375 3.175 2.1375 0.9 0.9 1.6125 1.95835 2.1375 3.175C21.7375 9.31665 22 10.61665 22 12c0 1.36665 -0.2625 2.65835 -0.7875 3.875 -0.525 1.21665 -1.2375 2.27915 -2.1375 3.1875 -0.9 0.90835 -1.95835 1.625 -3.175 2.15C14.68335 21.7375 13.38335 22 12 22Z"
          stroke-width="0.5"
        ></path>
      </svg>
      <span class="text-xs">Explore</span>
    </button>

    <button
      class="flex flex-col items-center justify-center space-y-1 p-2 text-gray-500"
      [class.text-secondary]="activeTab() === 'create'"
      [class.text-gray-500]="activeTab() !== 'create'"
    >
      <svg
        class="h-6 w-6"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        viewBox="0 0 16 16"
      >
        <path
          stroke="currentColor"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"
        />
      </svg>
      <span class="text-xs">Create</span>
    </button>

    <button
      class="flex flex-col items-center justify-center space-y-1 p-2 text-gray-500"
      [class.text-secondary]="activeTab() === 'inbox'"
      [class.text-gray-500]="activeTab() !== 'inbox'"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="icon icon-tabler icons-tabler-filled icon-tabler-bell"
      >
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <path
          d="M14.235 19c.865 0 1.322 1.024 .745 1.668a3.992 3.992 0 0 1 -2.98 1.332a3.992 3.992 0 0 1 -2.98 -1.332c-.552 -.616 -.158 -1.579 .634 -1.661l.11 -.006h4.471z"
        />
        <path
          d="M12 2c1.358 0 2.506 .903 2.875 2.141l.046 .171l.008 .043a8.013 8.013 0 0 1 4.024 6.069l.028 .287l.019 .289v2.931l.021 .136a3 3 0 0 0 1.143 1.847l.167 .117l.162 .099c.86 .487 .56 1.766 -.377 1.864l-.116 .006h-16c-1.028 0 -1.387 -1.364 -.493 -1.87a3 3 0 0 0 1.472 -2.063l.021 -.143l.001 -2.97a8 8 0 0 1 3.821 -6.454l.248 -.146l.01 -.043a3.003 3.003 0 0 1 2.562 -2.29l.182 -.017l.176 -.004z"
        />
      </svg>

      <span class="text-xs">Notification</span>
    </button>

    <button
      class="flex flex-col items-center justify-center space-y-1 p-2 text-gray-500"
      [class.text-secondary]="activeTab() === 'account'"
      [class.text-gray-500]="activeTab() !== 'account'"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
        viewBox="0 0 24 24"
        id="User-Circle-Single--Streamline-Core"
        height="24"
        width="24"
      >
        <g id="user-circle-single--circle-geometric-human-person-single-user">
          <path
            id="Union"
            fill-rule="evenodd"
            d="M24 12c0 3.2174914285714284 -1.2663428571428572 6.1392 -3.3276 8.294057142857142 -2.177142857142857 2.2757142857142854 -5.240914285714285 3.696 -8.63658857142857 3.705942857142857L12 24l-0.03581142857142857 0c-3.3956742857142856 -0.009942857142857142 -6.4595142857142855 -1.4302285714285714 -8.636537142857142 -3.705942857142857C1.2662725714285712 18.1392 0 15.217491428571428 0 12c0 -6.6274114285714285 5.3725885714285715 -12 12 -12 6.627428571428571 0 12 5.3725885714285715 12 12Zm-4.726628571428571 6C17.544171428571428 15.90594857142857 14.927897142857143 14.571377142857141 12 14.571377142857141c-2.9278971428571428 0 -5.544102857142857 1.3345714285714285 -7.273457142857142 3.4286228571428574 1.7293542857142858 2.094 4.34556 3.4285714285714284 7.273457142857142 3.4285714285714284 2.9278971428571428 0 5.5441714285714285 -1.3345714285714285 7.273371428571428 -3.4285714285714284ZM12.000205714285713 12.857091428571428c2.3669314285714287 0 4.285714285714286 -1.918782857142857 4.285714285714286 -4.285714285714286s-1.918782857142857 -4.285714285714286 -4.285714285714286 -4.285714285714286 -4.285714285714286 1.918782857142857 -4.285714285714286 4.285714285714286 1.918782857142857 4.285714285714286 4.285714285714286 4.285714285714286Z"
            clip-rule="evenodd"
            stroke-width="1.7143"
          ></path>
        </g>
      </svg>
      <span class="text-xs">Profile</span>
    </button>
  </div>
</nav>

<!-- Dektop Header -->
<header
  class="bg-primary fixed top-0 right-0 left-1/2 z-998 hidden w-full -translate-x-1/2 transform border-b border-white/30 sm:max-w-xl md:max-w-3xl lg:block lg:max-w-5xl xl:max-w-7xl 2xl:max-w-[110rem]"
>
  <div class="mx-auto flex items-center justify-between px-5 py-2">
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <img ngSrc="assets/logo.png" alt="trail-logo" width="35" height="35" priority="high" />
      <span class="text-secondary text-xl font-bold">Trail</span>
    </div>

    <!-- Center: Search Bar -->
    <div class="mx-8 max-w-lg flex-1">
      <div class="relative">
        <!-- Search Icon (Left) -->
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            ></path>
          </svg>
        </div>

        <!-- Clear Button (Right) -->
        @if (searchQuery()) {
          <div class="absolute inset-y-0 right-0 flex items-center pr-3">
            <button
              (click)="onClearSearch()"
              class="clear-search-btn cursor-pointer rounded-full p-1 transition-colors hover:bg-gray-700"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-x text-gray-400 hover:text-gray-200"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M18 6l-12 12" />
                <path d="M6 6l12 12" />
              </svg>
            </button>
          </div>
        }

        <input
          type="text"
          placeholder="Search Trail"
          [value]="searchQuery()"
          (input)="onSearch($event.target.value)"
          class="block w-full rounded-full bg-gray-500/30 py-2 pr-3 pl-10 text-sm text-gray-500 transition-colors hover:border-gray-400 focus:border-transparent focus:ring-2 focus:ring-gray-500 focus:outline-none"
        />

        <!-- Dropdown for search results -->
        @if (
          searchQuery() &&
          (unifiedSearchResults()?.posts?.length || unifiedSearchResults()?.communities?.length)
        ) {
          <div
            data-search-dropdown
            class="scrollbar-container absolute top-full right-0 left-0 z-50 mt-1 rounded-lg border border-white/30 bg-black shadow-lg"
          >
            <div class="hide-scrollbar max-h-96 overflow-y-auto">
              <!-- Communities Section -->
              @if (unifiedSearchResults()?.communities?.length) {
                <div class="border-b border-white/10 px-3 py-2">
                  <h3 class="text-xs font-semibold text-gray-400/50 uppercase">Communities</h3>
                </div>
                @for (community of unifiedSearchResults()?.communities; track community.id) {
                  <button
                    class="w-full cursor-pointer border-b border-white/10 px-4 py-3 text-left transition-colors hover:bg-gray-800/40"
                  >
                    <div class="flex items-center space-x-3">
                      <div
                        class="bg-secondary flex h-8 w-8 items-center justify-center rounded-full"
                      >
                        <span class="text-xs font-bold text-white">{{
                          community.communityName | initials
                        }}</span>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-white">{{ community.communityName }}</p>
                        @if (community.description) {
                          <p class="truncate text-xs text-gray-400">{{ community.description }}</p>
                        }
                      </div>
                    </div>
                  </button>
                }
              }

              <!-- Posts Section -->
              @if (unifiedSearchResults()?.posts?.length) {
                <div class="border-b border-white/10 px-3 py-2">
                  <h3 class="text-xs font-semibold text-gray-400/50 uppercase">Posts</h3>
                </div>
                @for (post of unifiedSearchResults()?.posts; track post.id) {
                  <button
                    class="w-full cursor-pointer border-b border-white/10 px-4 py-3 text-left transition-colors hover:bg-gray-800/40"
                  >
                    <p class="text-sm font-medium text-white">{{ post.title }}</p>
                    <p class="text-xs text-gray-400">By {{ post.author }}</p>
                  </button>
                }
              }
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Right Section: Actions + Profile -->
    <div class="flex items-center space-x-2">
      @if (isAuthenticated()) {
        <!-- Create Btn -->
        <app-tooltip toolTipText="Create a new post">
          <button
            class="flex cursor-pointer items-center space-x-1.5 rounded-full px-2 py-2 text-sm font-medium text-white transition-colors hover:bg-gray-800/40"
            routerLink="/create"
          >
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              ></path>
            </svg>
            <span>Create</span>
          </button>
        </app-tooltip>

        <!-- Notification -->
        <app-tooltip toolTipText="Notification">
          <button
            class="cursor-pointer rounded-full p-2 text-white transition-colors hover:bg-gray-800/40"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"
              />
            </svg>
          </button>
        </app-tooltip>

        <!-- Profile -->
        <div class="group relative inline-block">
          <button
            class="flex cursor-pointer items-center space-x-2 rounded-full p-1 transition-colors hover:bg-gray-800/40"
          >
            <div class="bg-secondary flex h-8 w-8 items-center justify-center rounded-full">
              <span class="text-sm font-bold text-white">{{ user()?.username | initials }}</span>
            </div>
          </button>

          <div
            class="invisible absolute right-0 mt-1 w-36 -translate-y-2 overflow-hidden rounded-md border border-white/30 bg-black opacity-0 transition-all duration-200 group-hover:visible group-hover:translate-y-0 group-hover:opacity-100"
          >
            @for (item of profileMenuItems; track $index) {
              <button
                (click)="toggleProfileMenu(item.action)"
                class="flex w-full cursor-pointer items-center px-3 py-2 text-left text-sm whitespace-nowrap text-white transition-colors hover:bg-white/20 focus:bg-gray-700 focus:outline-none"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  [attr.fill]="item.fill ? 'currentColor' : 'none'"
                  class="icon icon-tabler icons-tabler-filled h-5 w-5"
                  [class]="item.iconClass"
                >
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  @for (path of item.svgPath; track $index) {
                    <path [attr.d]="path" />
                  }
                </svg>
                <span class="ml-2">{{ item.label }}</span>
              </button>
            }
          </div>
        </div>
      } @else {
        <!-- Login Button -->
        <button
          routerLink="/login"
          class="bg-secondary hover:bg-secondary/80 cursor-pointer rounded-full px-5 py-2 text-xs font-medium tracking-wide text-white transition-colors duration-300"
        >
          Login
        </button>
      }
    </div>
  </div>
</header>

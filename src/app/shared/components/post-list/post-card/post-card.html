<div
  (click)="handlePostDetailNavigate($event)"
  class="rounded-lg px-4 py-3 hover:bg-gray-800/30 cursor-pointer"
>
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-2 font-light text-sm">
      <div class="w-5.5 h-5.5 bg-secondary rounded-full flex items-center justify-center">
        <span class="text-white text-xs lg:text-[10px] font-bold">{{
          post().communityName | initials
        }}</span>
      </div>
      <p class="text-gray-500 font-bold line-clamp-1 break-words text-xs lg:text-sm">
        {{ post().communityName }}
      </p>
      <p class="text-gray-500 text-xs lg:text-sm">{{ post().createdAt | timeago }}</p>
    </div>

    <div class="flex items-center space-x-1">
      @if (currentPath() === '/drafts') {
        <!-- Publish Button -->
        <button
          class="text-xs px-3 py-1 rounded-full cursor-pointer transition-colors duration-200 bg-secondary text-white hover:bg-secondary/70"
          (click)="handlePublishPost($event)"
        >
          Publish
        </button>
      } @else {
        <!-- Join btn -->
        <button
          class="text-xs px-3 py-1 rounded-full cursor-pointer transition-colors duration-200"
          (click)="toggleJoin($event)"
          [ngClass]="
            isUserJoined()
              ? 'text-gray-500 bg-transparent border border-gray-500 hover:bg-white/5'
              : 'bg-secondary text-white hover:bg-secondary/70'
          "
        >
          {{ isUserJoined() ? 'Joined' : 'Join' }}
        </button>
      }

      <!-- Three Dots -->
      <div class="relative" #menuContainer>
        <button
          class="action-btn text-white hover:bg-gray-800 px-2 py-2 rounded-full cursor-pointer"
          (click)="handleMenuItems($event)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-three-dots"
            viewBox="0 0 16 16"
          >
            <path
              d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"
            />
          </svg>
        </button>

        @if (isPostMenuOpen()) {
          <app-dropdown-menu
            animate.enter="dropdown-fade-in"
            animate.leave="dropdown-fade-out"
            styles="w-32 right-0"
            [isOwner]="post().isOwner"
            [dropdownItems]="menuItems()"
            modalType="menu"
            (menuItemClicked)="handleMenuItemClick($event)"
          />
        }
      </div>
    </div>
  </div>

  <div class="flex flex-col text-white space-y-2">
    <p class="font-medium tracking-wide text-lg">{{ post().title }}</p>
    <p class="font-light text-gray-500 text-sm line-clamp-2 break-words">{{ post().content }}</p>
  </div>

  @if (post().reactions && post().reactions.length > 0) {
    <div class="flex items-center space-x-1.5 mt-2">
      @for (reaction of post().reactions; track $index) {
        <button
          (click)="handleSelectReactionAction(reaction.reactionId, $event)"
          class="flex items-center space-x-1 px-2 py-1 text-white rounded-full cursor-pointer transition-colors duration-200"
          [ngClass]="
            hasReaction(reaction.reactionId)
              ? 'bg-gray-500/60 hover:bg-gray-500/40'
              : 'bg-black border border-white/30 hover:border-white/50'
          "
        >
          <span class="text-sm">{{ getReactionById(reaction.reactionId)?.type }}</span>
          <span class="text-sm">{{ reaction.count }}</span>
        </button>
      }
    </div>
  }

  <div
    class="flex items-center mt-3.5 space-x-2"
    [class.hidden]="currentPath() === '/drafts' || 'archives'"
  >
    <!-- React Button -->
    <div class="relative" #reactionContainer>
      <button
        class="action-btn flex items-center space-x-1 px-2 py-1 text-white bg-gray-500/40 rounded-full cursor-pointer hover:bg-white/20 transition-colors duration-200"
        (click)="handleReactModal($event)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="icon icon-tabler icons-tabler-filled icon-tabler-mood-happy"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path
            d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-2 9.66h-6a1 1 0 0 0 -1 1v.05a3.975 3.975 0 0 0 3.777 3.97l.227 .005a4.026 4.026 0 0 0 3.99 -3.79l.006 -.206a1 1 0 0 0 -1 -1.029zm-5.99 -5l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993zm6 0l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993z"
          />
        </svg>

        <span>React</span>
      </button>

      <!-- Reaction Modal -->
      @if (isPostReactModalOpen()) {
        <div
          animate.enter="dropdown-fade-in"
          animate.leave="dropdown-fade-out"
          class="absolute flex items-center mt-2 left-0 space-x-2 bg-black border border-white/30 rounded-full px-3 py-2 z-50"
          data-modal-type="react"
        >
          @for (reaction of reactionList(); track reaction.id) {
            <button
              (click)="handleSelectReactionAction(reaction.id, $event)"
              class="text-xl cursor-pointer hover:scale-125 transition-transform duration-200"
            >
              {{ reaction.type }}
            </button>
          }
        </div>
      }
    </div>

    <!-- Comment button -->
    <button
      class="flex items-center space-x-1 px-2 py-1 text-white bg-gray-500/40 rounded-full cursor-pointer hover:bg-white/20 transition-colors duration-200"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="icon icon-tabler icons-tabler-filled icon-tabler-message-circle"
      >
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <path
          d="M5.821 4.91c3.899 -2.765 9.468 -2.539 13.073 .535c3.667 3.129 4.168 8.238 1.152 11.898c-2.841 3.447 -7.965 4.583 -12.231 2.805l-.233 -.101l-4.374 .931l-.04 .006l-.035 .007h-.018l-.022 .005h-.038l-.033 .004l-.021 -.001l-.023 .001l-.033 -.003h-.035l-.022 -.004l-.022 -.002l-.035 -.007l-.034 -.005l-.016 -.004l-.024 -.005l-.049 -.016l-.024 -.005l-.011 -.005l-.022 -.007l-.045 -.02l-.03 -.012l-.011 -.006l-.014 -.006l-.031 -.018l-.045 -.024l-.016 -.011l-.037 -.026l-.04 -.027l-.002 -.004l-.013 -.009l-.043 -.04l-.025 -.02l-.006 -.007l-.056 -.062l-.013 -.014l-.011 -.014l-.039 -.056l-.014 -.019l-.005 -.01l-.042 -.073l-.007 -.012l-.004 -.008l-.007 -.012l-.014 -.038l-.02 -.042l-.004 -.016l-.004 -.01l-.017 -.061l-.007 -.018l-.002 -.015l-.005 -.019l-.005 -.033l-.008 -.042l-.002 -.031l-.003 -.01v-.016l-.004 -.054l.001 -.036l.001 -.023l.002 -.053l.004 -.025v-.019l.008 -.035l.005 -.034l.005 -.02l.004 -.02l.018 -.06l.003 -.013l1.15 -3.45l-.022 -.037c-2.21 -3.747 -1.209 -8.391 2.413 -11.119z"
        />
      </svg>

      <span>{{ post().totalComment }}</span>
    </button>

    <!-- Share button -->
    <div class="relative" #shareContainer>
      <button
        class="action-btn flex items-center space-x-1 px-2 py-1 text-white bg-gray-500/40 rounded-full cursor-pointer hover:bg-white/20 transition-colors duration-200"
        (click)="handleShareModal($event)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="icon icon-tabler icons-tabler-filled icon-tabler-chart-dots-3"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path
            d="M18 2a4 4 0 1 1 -3.843 5.114l-6.295 .786a3 3 0 0 1 -.094 .257l6.446 4.431a3 3 0 1 1 -.695 4.099l-3.527 1.058q .008 .127 .008 .255a4 4 0 1 1 -8 0l.005 -.2a4 4 0 0 1 7.366 -1.954l3.64 -1.094l.01 -.102q .023 -.204 .074 -.4l-6.688 -4.6a3 3 0 0 1 -4.407 -2.65l.005 -.176a3 3 0 0 1 5.784 -.931l6.312 -.79a4 4 0 0 1 3.899 -3.103"
          />
        </svg>

        <span>Share</span>
      </button>

      @if (isPostShareModalOpen()) {
        <app-dropdown-menu
          animate.enter="dropdown-fade-in"
          animate.leave="dropdown-fade-out"
          styles="w-32 mt-1 left-0"
          modalType="share"
          [dropdownItems]="shareItems()"
          (menuItemClicked)="handleShareItemClick($event)"
        />
      }
    </div>
  </div>
</div>

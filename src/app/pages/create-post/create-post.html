<div class="px-3 py-10 lg:px-15 2xl:px-23">
  <div class="mb-5 font-bold tracking-wide text-gray-500">
    <h2 class="text-3xl lg:text-4xl">Create Post</h2>
  </div>

  <!-- Select Commuity Btn -->
  <button
    #toggleButton
    (click)="showCommunitySelection()"
    class="relative w-full max-w-xs cursor-pointer rounded-2xl bg-gray-500/30 px-3 transition-colors duration-300 hover:bg-gray-500/35"
    [class.hidden]="isCommunitySelectionSelected()"
  >
    @if (!selectedCommunity()) {
      <div class="flex items-center space-x-3">
        <div
          class="pointer-events-none absolute inset-y-0 bottom-[3px] left-0 flex items-center pl-3 text-gray-400"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-users-group"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M10 13a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
            <path d="M8 21v-1a2 2 0 0 1 2 -2h4a2 2 0 0 1 2 2v1" />
            <path d="M15 5a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
            <path d="M17 10h2a2 2 0 0 1 2 2v1" />
            <path d="M5 5a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
            <path d="M3 13v-1a2 2 0 0 1 2 -2h2" />
          </svg>
        </div>

        <span class="w-full py-2 pr-3 pl-8 text-left font-medium text-gray-400"
          >Select Community</span
        >

        <div class="text-gray-400">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-down"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M6 9l6 6l6 -6" />
          </svg>
        </div>
      </div>
    } @else if (selectedCommunity()) {
      <div class="flex items-center justify-between rounded-lg py-2 transition-colors duration-300">
        <div class="flex items-center space-x-3">
          <div class="bg-secondary flex h-7 w-7 items-center justify-center rounded-full">
            <span class="text-xs font-bold text-white lg:text-sm">{{
              selectedCommunity()?.communityName | initials
            }}</span>
          </div>

          <span class="text-white">{{ selectedCommunity()?.communityName }}</span>
        </div>

        <button
          (click)="removeCommunity()"
          type="button"
          class="cursor-pointer text-gray-400 transition-colors hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-x"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M18 6l-12 12" />
            <path d="M6 6l12 12" />
          </svg>
        </button>
      </div>
    }
  </button>

  <form [formGroup]="postForm" (ngSubmit)="onPostSubmit()" #formContainer class="flex flex-col">
    <!-- Community -->
    <div class="relative mb-3" [class.hidden]="!isCommunitySelectionSelected()">
      <div
        class="pointer-events-none absolute inset-y-0 bottom-[3px] left-0 flex items-center pl-3"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-device-ipad-horizontal-search h-5 w-5 text-gray-500"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M11.5 20h-6.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v5.5" />
          <path d="M9 17h2" />
          <path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" />
          <path d="M20.2 20.2l1.8 1.8" />
        </svg>
      </div>

      <!-- Search Input -->
      <input
        #searchInput
        [formControl]="searchControl"
        type="text"
        placeholder="Search your communities"
        class="block w-full max-w-xs rounded-md border border-gray-500/80 py-2 pr-3 pl-10 text-sm text-gray-500 transition-colors hover:border-gray-500 focus:ring-1 focus:ring-gray-500 focus:outline-none"
      />

      <!-- Dropdown container -->
      <div
        #dropdownContainer
        class="scrollbar-container bg-primary absolute z-10 mt-2 w-full max-w-xs rounded-md border border-white/30"
      >
        <div class="hide-scrollbar max-h-64 overflow-y-auto">
          @if (filteredUserCommunities().length === 0) {
            <div class="px-4 py-3 text-sm text-gray-400">No Communities Found</div>
          } @else {
            @for (community of filteredUserCommunities(); track community.id) {
              <div
                (click)="selectCommunity(community)"
                class="cursor-pointer border-b border-gray-700/50 px-4 py-3 transition-colors last:border-b-0 hover:bg-gray-700/50"
              >
                <div class="flex items-center space-x-3 text-white">
                  <div class="bg-secondary flex h-7 w-7 items-center justify-center rounded-full">
                    <span class="text-xs font-bold text-white lg:text-sm">{{
                      community.communityName | initials
                    }}</span>
                  </div>

                  <span class="font-medium">{{ community.communityName }}</span>
                </div>
              </div>
            }
          }
        </div>
      </div>
    </div>

    <!-- Title -->
    <div
      class="bg-primary mt-8 flex w-full flex-col gap-1 rounded-md border border-white/30 px-3.5 py-1"
    >
      <div class="flex justify-between space-x-2">
        <label for="content" class="form-label font-light text-gray-500">Title</label>
        @if (titleErrors) {
          <div class="flex items-center space-x-1 text-red-700">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-exclamation-circle mt-[-3px] h-4 w-4"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
              <path d="M12 9v4" />
              <path d="M12 16v.01" />
            </svg>

            <span class="text-sm">Title is required</span>
          </div>
        }
      </div>
      <input
        id="title"
        formControlName="title"
        type="text"
        class="font-light text-white focus:border-transparent focus:outline-none"
      />
    </div>

    <!-- Content -->
    <div
      class="bg-primary mt-8 flex w-full flex-col gap-1 rounded-md border border-white/30 px-3.5 py-1"
    >
      <div class="flex justify-between space-x-2">
        <label for="content" class="form-label font-light text-gray-500">Content</label>
        @if (contentErrors) {
          <div class="flex items-center space-x-1 text-red-700">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon icon-tabler icons-tabler-outline icon-tabler-exclamation-circle mt-[-3px] h-4 w-4"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
              <path d="M12 9v4" />
              <path d="M12 16v.01" />
            </svg>

            <span class="text-sm">Content is required</span>
          </div>
        }
      </div>

      <textarea
        placeholder="What's on your mind?"
        id="content"
        rows="6"
        formControlName="content"
        type="text"
        class="font-light text-white placeholder:text-gray-600 focus:border-transparent focus:outline-none"
      ></textarea>
    </div>

    <div class="mt-5 flex justify-end">
      <div class="group relative inline-flex">
        <!-- Main Submit Button -->
        <button
          type="submit"
          [disabled]="postForm.invalid"
          class="bg-secondary group-hover:bg-secondary/80 cursor-pointer rounded-l-full py-3 pr-6 pl-8 text-sm font-medium text-white transition-colors duration-300 disabled:cursor-not-allowed disabled:bg-gray-500/20 disabled:text-gray-600"
        >
          @if (this.isSubmitting()) {
            <div class="flex items-center justify-center px-8 py-2.5">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 200 200"
                class="absolute h-8 w-8"
              >
                <circle fill="#FFEAC4" stroke="#FFEAC4" stroke-width="12" r="15" cx="40" cy="100">
                  <animate
                    attributeName="opacity"
                    calcMode="spline"
                    dur="2"
                    values="1;0;1;"
                    keySplines=".5 0 .5 1;.5 0 .5 1"
                    repeatCount="indefinite"
                    begin="-.4"
                  ></animate>
                </circle>
                <circle fill="#FFEAC4" stroke="#FFEAC4" stroke-width="12" r="15" cx="100" cy="100">
                  <animate
                    attributeName="opacity"
                    calcMode="spline"
                    dur="2"
                    values="1;0;1;"
                    keySplines=".5 0 .5 1;.5 0 .5 1"
                    repeatCount="indefinite"
                    begin="-.2"
                  ></animate>
                </circle>
                <circle fill="#FFEAC4" stroke="#FFEAC4" stroke-width="12" r="15" cx="160" cy="100">
                  <animate
                    attributeName="opacity"
                    calcMode="spline"
                    dur="2"
                    values="1;0;1;"
                    keySplines=".5 0 .5 1;.5 0 .5 1"
                    repeatCount="indefinite"
                    begin="0"
                  ></animate>
                </circle>
              </svg>
            </div>
          } @else {
            Create Post
          }
        </button>

        <!-- Divider -->
        <div
          class="w-[1px] bg-white/20 transition-colors duration-300 group-hover:bg-white/20"
        ></div>

        <!-- Dropdown Toggle Button -->
        <button
          #dropdownToggle
          type="button"
          (click)="toggleDropdown()"
          [disabled]="postForm.invalid"
          class="bg-secondary group-hover:bg-secondary/80 flex cursor-pointer items-center rounded-r-full py-3 pr-4 pl-2 text-sm font-medium text-white transition-colors duration-300 disabled:cursor-not-allowed disabled:bg-gray-500/20 disabled:text-gray-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-down transition-transform duration-200"
            [class.rotate-180]="isDropdownOpen()"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M6 9l6 6l6 -6" />
          </svg>
        </button>

        <!-- Dropdown Menu -->
        @if (isCreateDropdownOpen()) {
          <div
            #dropdownMenu
            animate.enter="animate-slideDown"
            animate.leave="animate-slideUp"
            class="bg-primary absolute top-full right-0 z-10 mt-2 w-44 overflow-hidden rounded-full border border-white/30 shadow-lg"
          >
            <button
              type="button"
              (click)="onDraftSubmit()"
              [disabled]="postForm.invalid"
              class="flex w-full cursor-pointer items-center gap-2 px-4 py-3 text-left text-sm text-white transition-colors duration-200 hover:bg-gray-700/50 disabled:cursor-not-allowed disabled:text-gray-600 disabled:hover:bg-transparent"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-pencil-check h-5 w-5"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
                <path d="M13.5 6.5l4 4" />
                <path d="M15 19l2 2l4 -4" />
              </svg>

              <span>Create Draft</span>
            </button>
          </div>
        }
      </div>
    </div>
  </form>
</div>
